<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>방명록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="./css/vistorlog.css">
    
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-firestore.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";
        import { getDocs } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyAzXX5j6y95F5-w-aemZc--QymtiWT_UVM",
            authDomain: "intro-team-42d34.firebaseapp.com",
            projectId: "intro-team-42d34",
            storageBucket: "intro-team-42d34.appspot.com",
            messagingSenderId: "367458824490",
            appId: "1:367458824490:web:cfeed0e953eab5a2206e53",
            measurementId: "G-Y60R200KGX"
        };

        // Initialize Firebase
        // Firebase 인스턴스 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);


        $("#logRegisterBtn").click(async function () {

            let name = $('#logName').val();
            let pw = $('#logPassword').val();
            let content = $('#logContent').val();
            const today = new Date();
            let day = today.getDate();
            let month = today.getMonth() + 1;
            let year = today.getFullYear();

            // This arrangement can be altered based on how we want the date's format to appear.
            let date = `${year}-${month}-${day}`;

            let doc = {
                'name': name,
                'pw': pw,
                'content': content,
                'date': date
            }
            await addDoc(collection(db, "logs"), doc);
            window.location.reload();
        });




        $(document).on("click", "#deleteLogBtn", function () {

            console.log("click");

            let parent = $(this).closest('div');

            let child = parent.children('div');
            let val = child.attr('content');
            console.log(val);
            parent.remove();

        });


        let docs = await getDocs(collection(db, "logs"));
        docs.forEach((doc) => {
            let row = doc.data();
            console.log(row);

            let name = row['name'];
            let pw = row['pw'];
            let content = row['content'];
            let date = row['date']

            let temp = `
            <div class="log">
                <div class="input-group mb-3">
                    <span class="input-group-text">${date}</span>
                    <span class="input-group-text">${name}</span>
                    <span><input type="text" id="deleteLogPw" placeholder="Password" aria-label="Password" class="form-control"></span>
                    <button class="btn btn-secondary" type="button" id="deleteLogBtn">삭제</button>
                    <div class="logText" content = ${content}>
                        ${content}
                    </div>
                </div>
            </div>
            `;

            $('#logBox').append(temp)
        });

        $("#member1").click(async function () {
            location.href = 'sunghun.html';
        });
        $("#member2").click(async function () {
            location.href = 'minsunpage.html';
        });
        $("#member3").click(async function () {
            location.href = 'minahpage.html';
        });
        $("#member4").click(async function () {
            location.href = 'yejinpage.html';
        });
        $("#home").click(async function () {
            location.href = 'index.html';
        });
        $('#visitor').click(function () {
            location.href = 'visitorlog.html';
        });
    </script>
</head>

<body>
    <div class="box1" style="position:relative;">
        <div class="uppertext" style="position: absolute;">
            <p class="text1" style="display:inline">TODAY <span class="red">2002</span> | TOTAL 118</p>
            <p class="text2" style="display:inline; font-size: 30px; font-weight: 600;">I-world</p>
            <p class="text3" style="display:inline">참고: https://www.cyworld.com</p>
        </div>
        <div class="box2">
            <p class="mood" style="font-size: 15px;">TODAY is 행복🎃</p>
            <div class="myimage">

            </div>
            <div class="introduce">
                <p style="font-size: 14px;">
                    I 좋은 사람들 I 좋은 세상 <br><br> 
                    내일배움캠프 <br> 3기 spring b반 3조 <br>
                    <br> I-WORLD 에 오신걸 <br> 환영합니다!
                </p>
            </div>
    </div>
        <div class="rings" style="position: absolute;">
            <div class="set1">
                <div class="ring"></div>
                <div class="ring"></div>
            </div>
            <div class="set2">
                <div class="ring"></div>
                <div class="ring"></div>
            </div>
        </div>
        <div class="box3">
            <div class="inputlogBox">
                <div class="input-group">
                    <span class="input-group-text">Name</span>
                    <input type="text" id="logName" placeholder="Name" aria-label="Name" class="form-control">
                    <span class="input-group-text">Password</span>
                    <input type="text" id="logPassword" placeholder="Password" aria-label="Password"
                        class="form-control">
                </div>

                <textarea class="form-control" id="logContent" rows="3"></textarea>

                <div>
                    <button type="button" id="logRegisterBtn" class="btn btn-secondary" style="float:right">등록</button>
                </div>

            </div>
            <div class="logBox">
                <div class="log" id="logBox">

                </div>
            </div>
        </div>
        <div class="buttons" style="position: absolute;">
            <button id="home">홈</button>
            <button id="member1">김성훈</button>
            <button id="member2">김민선</button>
            <button id="member3">유민아</button>
            <button id="member4">이예진</button>
            <button id="visitor">방명록</button>
        </div>
    </div>


</body>

</html>