<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë°©ëª…ë¡</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="./css/vistorlog.css">

    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.8.1/firebase-firestore.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    
    <script type="module">

        const firebaseConfig = {
            apiKey: "AIzaSyAzXX5j6y95F5-w-aemZc--QymtiWT_UVM",
            authDomain: "intro-team-42d34.firebaseapp.com",
            databaseURL: "https://intro-team-42d34-default-rtdb.firebaseio.com",
            projectId: "intro-team-42d34",
            storageBucket: "intro-team-42d34.appspot.com",
            messagingSenderId: "367458824490",
            appId: "1:367458824490:web:cfeed0e953eab5a2206e53",
            measurementId: "G-Y60R200KGX"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();


        //ë°©ëª…ë¡ ë“±ë¡í•˜ëŠ” ë¶€ë¶„
        $("#logRegisterBtn").click(async function () {

            let name = $('#logName').val();
            let pw = $('#logPassword').val();
            let content = $('#logContent').val();
            const today = new Date();
            let day = today.getDate();
            let month = today.getMonth() + 1;
            let year = today.getFullYear();

            let date = `${year}-${month}-${day}`;

            let doc = {
                'name': name,
                'pw': pw,
                'content': content,
                'date': date
            }
            //await addDoc(collection(db, "logs"), doc);

            await database.ref('logs').push(doc);



            //ë©”ì¸í˜ì´ì§€ì— ë³´ì´ê²Œ í•˜ê¸° ìœ„í•´ ì €ì¥
            localStorage.setItem('content', content);
            localStorage.setItem('name', name);
            //ë©”ì¸í˜ì´ì§€ ì €ì¥ ë¶€ë¶„ ë

            window.location.reload();
        });
        //ë°©ëª…ë¡ ë“±ë¡ ë


        //ë°©ëª…ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ë¶€ë¶„
        const dbRef = database.ref('logs');
        dbRef.on("value", (snapshot) => {
            snapshot.forEach((child) => {
                
                const object = child.val();
                let temp = `
    <div class="log">
        <div class="input-group mb-3">
            <span class="input-group-text">${object.date}</span>
            <span class="input-group-text">${object.name}</span>
            <span><input type="text" id="deleteLogPw" placeholder="Password" aria-label="Password" class="form-control"></span>
            <button class="btn btn-secondary" type="button" id="deleteLogBtn">ì‚­ì œ</button>
            <div class="logText" id = ${child.ref.key}>
                ${object.content}
            </div>
        </div>
    </div>
    `

                $('#logBox').append(temp)

            });
        });
        //ë°©ëª…ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ë¶€ë¶„ ëë‚¨


        //ë°©ëª…ë¡ ì‚­ì œí•˜ëŠ” ë¶€ë¶„
        $(document).on("click", "#deleteLogBtn", function () {

            //alert("click");

            let parentDiv = $(this).closest('div');
            let textDiv = parentDiv.children('.logText');
            let pwInput = parentDiv.find('input');


            let id = textDiv.attr('id');
            let password = pwInput.val();

            const dbRef = database.ref('logs');

            dbRef.on("value", (snapshot) => {
                snapshot.forEach((child) => {
                    const object = child.val();

                    if (id == child.ref.key) {
                        if (object.pw == password) {
                            dbRef.child(id).remove();
                        }
                        else {
                            alert("ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸");

                        }
                    }
                });
            });
            window.location.reload();
        });
        //ë°©ëª…ë¡ ì‚­ì œ ëë‚¨
    </script>
</head>

<body>
    <div class="box1" style="position:relative;">
        <div class="uppertext" style="position: absolute;">
            <p class="text1" style="display:inline">TODAY <span class="red">2002</span> | TOTAL 118</p>
            <p class="text2" style="display:inline; font-size: 30px; font-weight: 600;">I-world</p>
            <p class="text3" style="display:inline">ì°¸ê³ : https://www.cyworld.com</p>
        </div>
        <div class="box2">
            <p class="mood" style="font-size: 15px;">TODAY is í–‰ë³µğŸƒ</p>
            <div class="myimage">

            </div>
            <div class="introduce">
                <p style="font-size: 14px;">
                    I ì¢‹ì€ ì‚¬ëŒë“¤ I ì¢‹ì€ ì„¸ìƒ <br><br>
                    ë‚´ì¼ë°°ì›€ìº í”„ <br> 3ê¸° spring bë°˜ 3ì¡° <br>
                    <br> I-WORLD ì— ì˜¤ì‹ ê±¸ <br> í™˜ì˜í•©ë‹ˆë‹¤!
                </p>
            </div>
        </div>
        <div class="rings" style="position: absolute;">
            <div class="set1">
                <div class="ring"></div>
                <div class="ring"></div>
            </div>
            <div class="set2">
                <div class="ring"></div>
                <div class="ring"></div>
            </div>
        </div>
        <div class="box3">
            <div class="inputlogBox">
                <div class="input-group">
                    <span class="input-group-text">Name</span>
                    <input type="text" id="logName" placeholder="Name" aria-label="Name" class="form-control">
                    <span class="input-group-text">Password</span>
                    <input type="text" id="logPassword" placeholder="Password" aria-label="Password"
                        class="form-control">
                </div>

                <textarea class="form-control" id="logContent" rows="3"></textarea>

                <div>
                    <button type="button" id="logRegisterBtn" class="btn btn-secondary" style="float:right">ë“±ë¡</button>
                </div>

            </div>
            <div class="logBox">
                <div class="log" id="logBox">

                </div>
            </div>
        </div>
        <div class="buttons" style="position: absolute;">
            <button id="index" class="index">í™ˆ</button>
                <button id="sunghun" class="sunghun">ê¹€ì„±í›ˆ</button>
                <button id="minsun" class="minsun">ê¹€ë¯¼ì„ </button>
                <button id="minah" class="minah">ìœ ë¯¼ì•„</button>
                <button id="yejin" class="yejin">ì´ì˜ˆì§„</button>
                <button id="visitor" class="visitor">ë°©ëª…ë¡</button>
        </div>
    </div>

    <script src="../IntroTeam/db/buttonfunc.js"></script>
</body>

</html>